<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MarketEdge ‚Äî AI Trading Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg:#0d1117; --bg2:#131722; --bg3:#1c2333; --bg4:#1e2a3a;
  --border:#2a3550; --accent:#2962FF; --accent2:#00bcd4;
  --green:#26a69a; --red:#ef5350; --text:#d1d4dc;
  --text2:#787b86; --text3:#9ba3af; --gold:#f0b429;
  --font-ui:'Syne',sans-serif; --font-mono:'JetBrains Mono',monospace;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg);color:var(--text);font-family:var(--font-ui);display:flex;flex-direction:column;}

/* DISCLAIMER */
.disclaimer{background:rgba(240,180,41,.08);border-bottom:1px solid rgba(240,180,41,.25);padding:7px 20px;font-size:11px;color:var(--gold);text-align:center;font-family:var(--font-mono);flex-shrink:0;}

/* TICKER */
.ticker-wrap{background:var(--bg2);border-bottom:1px solid var(--border);height:34px;overflow:hidden;position:relative;flex-shrink:0;}
.ticker-wrap::before,.ticker-wrap::after{content:'';position:absolute;top:0;width:60px;height:100%;z-index:2;pointer-events:none;}
.ticker-wrap::before{left:0;background:linear-gradient(90deg,var(--bg2),transparent);}
.ticker-wrap::after{right:0;background:linear-gradient(-90deg,var(--bg2),transparent);}
.ticker-inner{display:flex;align-items:center;height:100%;animation:scrollT 40s linear infinite;width:max-content;}
@keyframes scrollT{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.t-item{display:flex;align-items:center;gap:7px;padding:0 20px;font-family:var(--font-mono);font-size:11px;border-right:1px solid var(--border);white-space:nowrap;}
.up{color:var(--green);} .dn{color:var(--red);}

/* NAV */
nav{background:var(--bg2);border-bottom:1px solid var(--border);padding:0 20px;height:52px;display:flex;align-items:center;gap:14px;flex-shrink:0;}
.logo{font-size:17px;font-weight:800;color:#fff;display:flex;align-items:center;gap:8px;flex-shrink:0;}
.logo-icon{width:28px;height:28px;background:var(--accent);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:13px;}
.logo span{color:var(--accent);}
.search-bar{flex:1;max-width:300px;background:var(--bg3);border:1px solid var(--border);border-radius:7px;display:flex;align-items:center;gap:8px;padding:0 11px;height:34px;}
.search-bar:focus-within{border-color:var(--accent);}
.search-bar input{background:none;border:none;outline:none;color:var(--text);font-family:var(--font-ui);font-size:12px;width:100%;}
.search-bar input::placeholder{color:var(--text2);}
.nav-links{display:flex;gap:2px;margin-left:6px;}
.nav-link{padding:5px 10px;border-radius:6px;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .15s;text-decoration:none;}
.nav-link:hover{color:var(--text);background:var(--bg3);}
.nav-link.active{color:var(--accent);background:rgba(41,98,255,.12);}
.nav-right{margin-left:auto;display:flex;align-items:center;gap:10px;}
.market-pill{display:flex;align-items:center;gap:5px;background:rgba(38,166,154,.1);border:1px solid rgba(38,166,154,.3);border-radius:20px;padding:3px 9px;font-size:10px;font-weight:600;color:var(--green);font-family:var(--font-mono);}
.dot{width:5px;height:5px;border-radius:50%;background:var(--green);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.avatar{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;cursor:pointer;color:#fff;}

/* MAIN APP */
.app-body{display:flex;flex:1;overflow:hidden;}

/* SIDEBAR */
aside{width:52px;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;padding:12px 0;gap:3px;flex-shrink:0;overflow-y:auto;}
.side-btn{width:38px;height:38px;border-radius:7px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;color:var(--text2);}
.side-btn:hover{background:var(--bg3);color:var(--text);}
.side-btn.active{background:rgba(41,98,255,.15);color:var(--accent);}
.side-btn svg{width:16px;height:16px;}
.side-div{width:28px;height:1px;background:var(--border);margin:4px 0;}

/* CONTENT */
.content{flex:1;display:flex;gap:0;overflow:hidden;}

/* LEFT PANEL */
.left-panel{width:380px;flex-shrink:0;border-right:1px solid var(--border);display:flex;flex-direction:column;overflow-y:auto;background:var(--bg2);}
.lp-section{padding:14px;border-bottom:1px solid var(--border);}
.lp-title{font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px;}

/* SYMBOL SELECTOR */
.sym-input{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:7px;padding:8px 12px;color:var(--text);font-family:var(--font-mono);font-size:13px;outline:none;transition:border-color .2s;}
.sym-input:focus{border-color:var(--accent);}
.quick-chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;}
.chip{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;font-family:var(--font-mono);cursor:pointer;border:1px solid var(--border);color:var(--text2);background:var(--bg3);transition:all .15s;}
.chip:hover,.chip.active{background:rgba(41,98,255,.15);border-color:var(--accent);color:var(--accent);}
.tf-row{display:flex;gap:5px;margin-top:10px;}
.tf-btn{flex:1;padding:5px 4px;border-radius:6px;font-size:10px;font-weight:600;font-family:var(--font-mono);cursor:pointer;border:1px solid var(--border);color:var(--text2);background:var(--bg3);text-align:center;transition:all .15s;}
.tf-btn:hover,.tf-btn.active{background:var(--accent);border-color:var(--accent);color:#fff;}

/* MINI CHART */
.mini-chart-box{background:var(--bg3);border-radius:8px;padding:10px;margin-bottom:10px;}
.chart-sym-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.chart-sym-name{font-family:var(--font-mono);font-size:14px;font-weight:700;color:#fff;}
.chart-price{font-family:var(--font-mono);font-size:13px;font-weight:600;}

/* ANALYZE BTN */
.analyze-btn{width:100%;padding:10px;border-radius:8px;background:var(--accent);color:#fff;border:none;font-family:var(--font-ui);font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.analyze-btn:hover{background:#1a4fd8;transform:translateY(-1px);}
.analyze-btn:active{transform:translateY(0);}

/* AI RESULT CARD */
.result-card{background:var(--bg3);border-radius:10px;padding:14px;border:1px solid var(--border);display:none;}
.result-card.show{display:block;animation:fadeIn .4s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

.rec-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 18px;border-radius:8px;font-size:20px;font-weight:800;margin-bottom:12px;}
.rec-badge.buy{background:rgba(38,166,154,.2);color:var(--green);border:2px solid var(--green);}
.rec-badge.sell{background:rgba(239,83,80,.2);color:var(--red);border:2px solid var(--red);}
.rec-badge.hold{background:rgba(240,180,41,.15);color:var(--gold);border:2px solid var(--gold);}

.conf-row{display:flex;align-items:center;gap:8px;margin-bottom:12px;}
.conf-label{font-size:11px;color:var(--text2);font-family:var(--font-mono);width:80px;}
.conf-bar{flex:1;height:6px;background:var(--bg4);border-radius:3px;overflow:hidden;}
.conf-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width 1s ease;}
.conf-val{font-size:11px;font-family:var(--font-mono);color:var(--text);width:34px;text-align:right;}

.target-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px;}
.target-box{background:var(--bg4);border-radius:6px;padding:8px;text-align:center;}
.target-lbl{font-size:9px;color:var(--text2);text-transform:uppercase;letter-spacing:.6px;margin-bottom:3px;}
.target-val{font-family:var(--font-mono);font-size:13px;font-weight:700;}

/* INDICATOR GRID */
.ind-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;}
.ind-card{background:var(--bg4);border-radius:6px;padding:8px 10px;}
.ind-name{font-size:9px;color:var(--text2);text-transform:uppercase;letter-spacing:.6px;margin-bottom:3px;}
.ind-val{font-size:12px;font-weight:700;font-family:var(--font-mono);}
.ind-sig{font-size:9px;margin-top:2px;}

/* ACTION BTNS */
.action-row{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:10px;}
.act-btn{padding:7px 8px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;border:1px solid var(--border);background:var(--bg4);color:var(--text);transition:all .15s;text-align:center;}
.act-btn:hover{border-color:var(--accent);color:var(--accent);}

/* RIGHT PANEL ‚Äî CHAT */
.right-panel{flex:1;display:flex;flex-direction:column;overflow:hidden;background:var(--bg);}

/* CHAT HEADER */
.chat-header{padding:12px 16px;border-bottom:1px solid var(--border);background:var(--bg2);display:flex;align-items:center;gap:12px;flex-shrink:0;}
.bot-avatar{width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:16px;position:relative;flex-shrink:0;}
.bot-avatar::after{content:'';position:absolute;inset:-3px;border-radius:50%;border:2px solid var(--accent);animation:avatarPulse 2s infinite;}
@keyframes avatarPulse{0%,100%{opacity:.4;transform:scale(1)}50%{opacity:.8;transform:scale(1.05)}}
.bot-info{flex:1;}
.bot-name{font-size:14px;font-weight:700;color:#fff;}
.bot-sub{font-size:10px;color:var(--text2);font-family:var(--font-mono);}
.mode-toggle{display:flex;gap:4px;background:var(--bg3);border-radius:8px;padding:3px;}
.mode-btn{padding:5px 14px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;transition:all .15s;border:none;background:none;color:var(--text2);}
.mode-btn.active{background:var(--accent);color:#fff;}
.chat-actions{display:flex;gap:6px;}
.icon-btn{width:30px;height:30px;border-radius:6px;background:var(--bg3);border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text2);transition:all .15s;font-size:13px;}
.icon-btn:hover{border-color:var(--accent);color:var(--accent);}

/* CHAT WINDOW */
.chat-window{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;}
.chat-window::-webkit-scrollbar{width:4px;}
.chat-window::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}

/* MESSAGES */
.msg{display:flex;gap:10px;animation:msgIn .3s ease;}
@keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.msg.user{flex-direction:row-reverse;}
.msg-avatar{width:32px;height:32px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:13px;}
.msg-avatar.bot{background:linear-gradient(135deg,var(--accent),var(--accent2));}
.msg-avatar.user{background:linear-gradient(135deg,#7c3aed,#2962FF);}
.msg-bubble{max-width:72%;padding:10px 14px;border-radius:12px;font-size:13px;line-height:1.6;}
.msg.bot .msg-bubble{background:var(--bg3);border:1px solid var(--border);border-bottom-left-radius:3px;}
.msg.user .msg-bubble{background:var(--accent);color:#fff;border-bottom-right-radius:3px;}
.msg-time{font-size:9px;color:var(--text2);font-family:var(--font-mono);margin-top:4px;}
.msg.user .msg-time{text-align:right;}
.msg-wrap{display:flex;flex-direction:column;max-width:72%;}
.msg.user .msg-wrap{align-items:flex-end;}

/* INLINE BADGES */
.inline-badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:5px;font-weight:700;font-size:12px;font-family:var(--font-mono);}
.inline-badge.buy{background:rgba(38,166,154,.2);color:var(--green);}
.inline-badge.sell{background:rgba(239,83,80,.2);color:var(--red);}
.inline-badge.hold{background:rgba(240,180,41,.15);color:var(--gold);}

/* DATA TABLE IN MSG */
.msg-table{width:100%;border-collapse:collapse;margin-top:8px;font-size:11px;font-family:var(--font-mono);}
.msg-table td{padding:4px 8px;border-bottom:1px solid rgba(42,53,80,.5);}
.msg-table td:first-child{color:var(--text2);}
.msg-table td:last-child{color:#fff;font-weight:600;text-align:right;}

/* TYPING INDICATOR */
.typing{display:flex;gap:10px;align-items:center;}
.typing-dots{display:flex;gap:4px;padding:10px 14px;background:var(--bg3);border-radius:12px;border:1px solid var(--border);}
.typing-dots span{width:6px;height:6px;border-radius:50%;background:var(--text2);animation:dot 1.2s infinite;}
.typing-dots span:nth-child(2){animation-delay:.2s;}
.typing-dots span:nth-child(3){animation-delay:.4s;}
@keyframes dot{0%,60%,100%{transform:translateY(0);opacity:.4}30%{transform:translateY(-5px);opacity:1}}

/* SUGGESTED CHIPS */
.suggest-row{padding:8px 16px;display:flex;gap:6px;flex-wrap:wrap;border-top:1px solid var(--border);background:var(--bg2);flex-shrink:0;}
.suggest-chip{padding:5px 11px;border-radius:14px;font-size:11px;font-weight:600;cursor:pointer;border:1px solid var(--border);color:var(--text2);background:var(--bg3);white-space:nowrap;transition:all .15s;}
.suggest-chip:hover{border-color:var(--accent);color:var(--accent);}

/* CHAT INPUT */
.chat-input-row{padding:10px 14px;background:var(--bg2);border-top:1px solid var(--border);display:flex;gap:8px;align-items:center;flex-shrink:0;}
.chat-input{flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:9px 14px;color:var(--text);font-family:var(--font-ui);font-size:13px;outline:none;resize:none;transition:border-color .2s;max-height:100px;}
.chat-input:focus{border-color:var(--accent);}
.send-btn{width:38px;height:38px;border-radius:9px;background:var(--accent);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;transition:all .2s;flex-shrink:0;}
.send-btn:hover{background:#1a4fd8;transform:scale(1.05);}
.mic-btn{width:38px;height:38px;border-radius:9px;background:var(--bg3);border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text2);transition:all .2s;flex-shrink:0;}
.mic-btn:hover{border-color:var(--red);color:var(--red);}
.mic-btn.listening{background:rgba(239,83,80,.15);border-color:var(--red);color:var(--red);animation:micPulse 1s infinite;}
@keyframes micPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}

/* VOICE MODE */
.voice-mode{display:none;flex:1;flex-direction:column;align-items:center;justify-content:center;gap:24px;padding:30px;}
.voice-mode.active{display:flex;}
.waveform-box{width:100%;max-width:400px;height:80px;position:relative;}
.waveform-svg{width:100%;height:100%;}
.voice-mic-btn{width:90px;height:90px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:32px;transition:all .2s;box-shadow:0 0 0 0 rgba(41,98,255,.4);}
.voice-mic-btn.listening{animation:voicePulse 1.5s infinite;}
@keyframes voicePulse{0%{box-shadow:0 0 0 0 rgba(41,98,255,.6)}70%{box-shadow:0 0 0 25px rgba(41,98,255,0)}100%{box-shadow:0 0 0 0 rgba(41,98,255,0)}}
.voice-status{font-size:14px;color:var(--text2);font-family:var(--font-mono);}
.voice-transcript{font-size:16px;color:#fff;font-weight:600;text-align:center;min-height:24px;}
.voice-response{max-width:500px;text-align:center;font-size:13px;color:var(--text3);line-height:1.6;background:var(--bg3);padding:14px 20px;border-radius:10px;border:1px solid var(--border);}

/* RISK badge */
.risk-badge{display:inline-flex;padding:2px 8px;border-radius:5px;font-size:10px;font-weight:700;font-family:var(--font-mono);}
.risk-low{background:rgba(38,166,154,.15);color:var(--green);}
.risk-med{background:rgba(240,180,41,.15);color:var(--gold);}
.risk-high{background:rgba(239,83,80,.15);color:var(--red);}

/* RESPONSIVE */
@media(max-width:900px){
  .left-panel{width:100%;border-right:none;border-bottom:1px solid var(--border);max-height:40vh;}
  .content{flex-direction:column;}
  .nav-links{display:none;}
}
aside a {
  text-decoration: none;
  color: inherit;
  display: block;
}
</style>
</head>
<body>

<!-- DISCLAIMER -->
<div class="disclaimer">‚ö†Ô∏è AI analysis is for educational purposes only. Not SEBI registered investment advice. Trading in securities involves risk. Trade at your own risk.</div>

<!-- TICKER -->
<div class="ticker-wrap"><div class="ticker-inner" id="tickerInner"></div></div>

<!-- NAV -->
<nav>
  <div class="logo"><div class="logo-icon">üìà</div>Market<span>Edge</span></div>
  <div class="search-bar"><span style="color:var(--text2);font-size:13px">üîç</span><input type="text" placeholder="Search stocks, indices, F&O..."/></div>
<div class="nav-links">
  <a href="page1-dashboard.html">Dashboard</a>
  <a href="page2-charts.html">Charts</a>
  <a href="page3-screener.html">Screener</a>
  <a href="page4-options.html">Options</a>
  <a href="page5-orders.html">Orders</a>
  <a href="page6-portfolio.html">Portfolio</a>
  <a href="page7-watchlist.html">Watchlist</a>
  <a href="page8-paper-trading.html">Paper Trade</a>
  <a href="page9-ai-assistant.html">AI Assistant</a>
</div>
  <div class="nav-right">
    <div class="market-pill"><div class="dot"></div>NSE LIVE</div>
    <div class="avatar">AK</div>
  </div>
</nav>

<!-- APP BODY -->
<div class="app-body">

  <!-- SIDEBAR -->
<aside>
  <a href="page1-dashboard.html"><div class="side-btn" title="Dashboard"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg></div></a>

  <a href="page2-charts.html"><div class="side-btn" title="Charts"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div></a>

  <a href="page3-screener.html"><div class="side-btn" title="Screener"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div></a>

  <div class="side-div"></div>

  <a href="page6-portfolio.html"><div class="side-btn" title="Portfolio"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg></div></a>

  <a href="page9-ai-assistant.html"><div class="side-btn active" title="AI Bot"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M12 12v2"/><rect x="8" y="14" width="8" height="6" rx="2"/><line x1="9" y1="17" x2="9" y2="17"/><line x1="15" y1="17" x2="15" y2="17"/></svg></div></a>

  <div class="side-div"></div>

  <a href="#"><div class="side-btn" title="Settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></div></a>
</aside>

  <!-- CONTENT -->
  <div class="content">

    <!-- LEFT PANEL -->
    <div class="left-panel">

      <!-- SYMBOL SELECTOR -->
      <div class="lp-section">
        <div class="lp-title">Analyze Stock</div>
        <input class="sym-input" id="symInput" type="text" placeholder="Enter symbol (e.g. NIFTY, RELIANCE)" value="NIFTY"/>
        <div class="quick-chips">
          <div class="chip active" onclick="selectSym(this,'NIFTY')">NIFTY</div>
          <div class="chip" onclick="selectSym(this,'BANKNIFTY')">BANKNIFTY</div>
          <div class="chip" onclick="selectSym(this,'RELIANCE')">RELIANCE</div>
          <div class="chip" onclick="selectSym(this,'TCS')">TCS</div>
          <div class="chip" onclick="selectSym(this,'SBIN')">SBIN</div>
          <div class="chip" onclick="selectSym(this,'INFY')">INFY</div>
        </div>
        <div class="tf-row">
          <div class="tf-btn active" onclick="selectTf(this,'Intraday')">Intraday</div>
          <div class="tf-btn" onclick="selectTf(this,'Short Term')">Short</div>
          <div class="tf-btn" onclick="selectTf(this,'Swing')">Swing</div>
          <div class="tf-btn" onclick="selectTf(this,'Positional')">Position</div>
        </div>
      </div>

      <!-- MINI CHART PREVIEW -->
      <div class="lp-section">
        <div class="mini-chart-box">
          <div class="chart-sym-row">
            <div class="chart-sym-name" id="chartSymName">NIFTY 50</div>
            <div>
              <div class="chart-price up" id="chartPrice">‚Çπ22,147.90</div>
              <div style="font-size:10px;text-align:right" class="up" id="chartChg">‚ñ≤ +0.83%</div>
            </div>
          </div>
          <!-- SVG Mini Chart -->
          <svg width="100%" height="70" viewBox="0 0 320 70" preserveAspectRatio="none">
            <defs>
              <linearGradient id="mcg" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#2962FF" stop-opacity=".4"/>
                <stop offset="100%" stop-color="#2962FF" stop-opacity="0"/>
              </linearGradient>
            </defs>
            <path id="miniChartPath" d="M0,55 C20,52 40,45 60,38 S100,20 130,18 S180,25 210,20 S260,10 290,8 S310,7 320,6 L320,70 L0,70 Z" fill="url(#mcg)"/>
            <path d="M0,55 C20,52 40,45 60,38 S100,20 130,18 S180,25 210,20 S260,10 290,8 S310,7 320,6" fill="none" stroke="#2962FF" stroke-width="1.5"/>
            <circle cx="320" cy="6" r="3" fill="#2962FF"/>
          </svg>
        </div>
        <button class="analyze-btn" onclick="runAnalysis()">
          <span>üîç</span> Analyze with AI
        </button>
      </div>

      <!-- AI RESULT -->
      <div class="lp-section">
        <div class="result-card" id="resultCard">
          <div class="rec-badge buy" id="recBadge">üìà BUY</div>
          <div class="conf-row">
            <span class="conf-label">Confidence</span>
            <div class="conf-bar"><div class="conf-fill" id="confFill" style="width:0%"></div></div>
            <span class="conf-val" id="confVal">0%</span>
          </div>
          <div class="target-row">
            <div class="target-box">
              <div class="target-lbl">Target</div>
              <div class="target-val up" id="targetPrice">‚Äî</div>
            </div>
            <div class="target-box">
              <div class="target-lbl">Stop Loss</div>
              <div class="target-val dn" id="slPrice">‚Äî</div>
            </div>
            <div class="target-box">
              <div class="target-lbl">Return</div>
              <div class="target-val up" id="retVal">‚Äî</div>
            </div>
          </div>
          <div class="lp-title" style="margin-bottom:8px">Technical Indicators</div>
          <div class="ind-grid" id="indGrid"></div>
          <div class="action-row">
            <div class="act-btn" onclick="openChart()">üìà Open Chart</div>
            <div class="act-btn" onclick="placeOrder()">üí∞ Place Order</div>
            <div class="act-btn" onclick="addWatch()">‚≠ê Watchlist</div>
            <div class="act-btn" onclick="shareAnalysis()">üì§ Share</div>
          </div>
        </div>
        <div id="noResult" style="text-align:center;padding:20px;color:var(--text2);font-size:13px">
          <div style="font-size:32px;margin-bottom:8px">ü§ñ</div>
          Select a stock and click <strong style="color:var(--accent)">Analyze with AI</strong> to get started
        </div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right-panel">

      <!-- CHAT HEADER -->
      <div class="chat-header">
        <div class="bot-avatar">ü§ñ</div>
        <div class="bot-info">
          <div class="bot-name">MarketEdge AI</div>
          <div class="bot-sub">Powered by Claude ¬∑ NSE Live Data ¬∑ 9:15 AM‚Äì3:30 PM IST</div>
        </div>
        <div class="mode-toggle">
          <button class="mode-btn active" id="chatModeBtn" onclick="setMode('chat')">üí¨ Chat</button>
          <button class="mode-btn" id="voiceModeBtn" onclick="setMode('voice')">üé§ Voice</button>
        </div>
        <div class="chat-actions">
          <div class="icon-btn" onclick="clearChat()" title="Clear Chat">üóëÔ∏è</div>
          <div class="icon-btn" onclick="downloadAnalysis()" title="Export">üíæ</div>
        </div>
      </div>

      <!-- CHAT MODE -->
      <div id="chatMode" style="display:flex;flex-direction:column;flex:1;overflow:hidden;">
        <div class="chat-window" id="chatWindow"></div>
        <div class="suggest-row" id="suggestRow">
          <div class="suggest-chip" onclick="sendSuggestion(this)">Should I buy NIFTY now?</div>
          <div class="suggest-chip" onclick="sendSuggestion(this)">What is RELIANCE's trend?</div>
          <div class="suggest-chip" onclick="sendSuggestion(this)">Best F&O strategy today?</div>
          <div class="suggest-chip" onclick="sendSuggestion(this)">Explain Iron Condor</div>
          <div class="suggest-chip" onclick="sendSuggestion(this)">Is TCS a good buy?</div>
        </div>
        <div class="chat-input-row">
          <textarea class="chat-input" id="chatInput" rows="1" placeholder="Ask me about any stock, strategy, or market condition..."></textarea>
          <button class="mic-btn" id="micBtn" onclick="toggleMicInline()" title="Voice Input">üé§</button>
          <button class="send-btn" onclick="sendMessage()" title="Send">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
          </button>
        </div>
      </div>

      <!-- VOICE MODE -->
      <div class="voice-mode" id="voiceMode">
        <div style="font-size:13px;color:var(--text2);font-family:var(--font-mono)">VOICE MODE ‚Äî Hold mic to speak</div>
        <div class="waveform-box">
          <svg class="waveform-svg" id="waveformSvg" viewBox="0 0 400 80" preserveAspectRatio="none">
            <g id="waveformBars"></g>
          </svg>
        </div>
        <div class="voice-transcript" id="voiceTranscript">Say a stock name or ask a question...</div>
        <button class="voice-mic-btn" id="voiceMicBtn" onmousedown="startVoice()" onmouseup="stopVoice()" ontouchstart="startVoice()" ontouchend="stopVoice()">üé§</button>
        <div class="voice-status" id="voiceStatus">Hold to speak ¬∑ Release to analyze</div>
        <div class="voice-response" id="voiceResponse" style="display:none"></div>
        <button onclick="setMode('chat')" style="padding:7px 18px;border-radius:7px;background:var(--bg3);border:1px solid var(--border);color:var(--text2);cursor:pointer;font-size:12px;font-family:var(--font-ui)">Switch to Chat</button>
      </div>

    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA & STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentSym = 'NIFTY';
let currentTf = 'Intraday';
let isListening = false;
let recognition = null;
let synth = window.speechSynthesis;

const stockData = {
  'NIFTY':      {price:22147.90, name:'NIFTY 50',      sector:'Index'},
  'BANKNIFTY':  {price:47892.45, name:'Bank Nifty',    sector:'Index'},
  'RELIANCE':   {price:2941.00,  name:'Reliance Ind.', sector:'Energy'},
  'TCS':        {price:3812.50,  name:'TCS Ltd.',      sector:'IT'},
  'SBIN':       {price:763.40,   name:'State Bank',    sector:'Banking'},
  'INFY':       {price:1567.25,  name:'Infosys Ltd.',  sector:'IT'},
  'HDFCBANK':   {price:1642.80,  name:'HDFC Bank',     sector:'Banking'},
  'TATAMOTORS': {price:962.50,   name:'Tata Motors',   sector:'Auto'},
  'WIPRO':      {price:456.30,   name:'Wipro Ltd.',    sector:'IT'},
  'BAJFINANCE': {price:6841.00,  name:'Bajaj Finance', sector:'Finance'},
};

const tickers = [
  {s:'NIFTY 50',p:'22,147.90',c:'+0.83%',u:1},{s:'SENSEX',p:'73,088',c:'+0.79%',u:1},
  {s:'BANKNIFTY',p:'47,892',c:'+1.12%',u:1},{s:'RELIANCE',p:'2,941',c:'+1.45%',u:1},
  {s:'TCS',p:'3,812',c:'-0.32%',u:0},{s:'INFY',p:'1,567',c:'+0.91%',u:1},
  {s:'SBIN',p:'763',c:'+2.11%',u:1},{s:'TATAMOTORS',p:'962',c:'+4.31%',u:1},
  {s:'WIPRO',p:'456',c:'-1.20%',u:0},{s:'BAJFINANCE',p:'6,841',c:'+0.55%',u:1},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BUILD TICKER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ti = document.getElementById('tickerInner');
[...tickers,...tickers].forEach(d => {
  const el = document.createElement('div'); el.className='t-item';
  el.innerHTML=`<span style="color:#fff;font-weight:600">${d.s}</span><span style="color:var(--text3)">${d.p}</span><span class="${d.u?'up':'dn'}">${d.c}</span>`;
  ti.appendChild(el);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SYMBOL SELECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function selectSym(el, sym) {
  document.querySelectorAll('.quick-chips .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  currentSym = sym;
  document.getElementById('symInput').value = sym;
  const d = stockData[sym] || {price:Math.floor(Math.random()*5000+500), name:sym};
  document.getElementById('chartSymName').textContent = d.name || sym;
  document.getElementById('chartPrice').textContent = '‚Çπ' + d.price.toLocaleString('en-IN');
  const chg = (Math.random()*4-2).toFixed(2);
  const el2 = document.getElementById('chartChg');
  el2.textContent = (chg>0?'‚ñ≤ +':'‚ñº ') + chg + '%';
  el2.className = chg>0?'up':'dn';
  // Animate chart
  animateMiniChart();
}

function selectTf(el, tf) {
  document.querySelectorAll('.tf-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  currentTf = tf;
}

function animateMiniChart() {
  // Generate random uptrending path
  let pts = [];
  let y = 55 + Math.random()*10;
  for(let x=0;x<=320;x+=20){
    y = Math.max(5, Math.min(65, y + (Math.random()-0.38)*12));
    pts.push(`${x},${y}`);
  }
  const last = pts[pts.length-1].split(',');
  const pathD = `M${pts.join(' C').replace(/ C/g,' L')} L320,70 L0,70 Z`;
  const lineD = `M${pts.join(' L')}`;
  const path = document.getElementById('miniChartPath');
  path.setAttribute('d', pathD);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI ANALYSIS ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function runAnalysis() {
  const sym = document.getElementById('symInput').value.toUpperCase() || currentSym;
  currentSym = sym;
  const btn = document.querySelector('.analyze-btn');
  btn.innerHTML = '<span>‚è≥</span> Analyzing...';
  btn.disabled = true;

  setTimeout(() => {
    btn.innerHTML = '<span>üîç</span> Analyze with AI';
    btn.disabled = false;
    showAnalysisResult(sym);
    sendBotAnalysis(sym);
  }, 1800);
}

function generateAnalysis(sym) {
  const d = stockData[sym] || {price: Math.floor(Math.random()*3000+500)};
  const price = d.price;
  const signals = ['BUY','SELL','HOLD'];
  const rsi = Math.floor(Math.random()*60+20);
  const signal = rsi < 35 ? 'BUY' : rsi > 68 ? 'SELL' : 'HOLD';
  const conf = signal==='BUY' ? Math.floor(Math.random()*15+75) : signal==='SELL' ? Math.floor(Math.random()*15+70) : Math.floor(Math.random()*20+50);
  const tpPct = signal==='BUY' ? (Math.random()*3+2) : (Math.random()*3+3);
  const slPct = signal==='BUY' ? (Math.random()*1.5+1) : (Math.random()*1+1.5);
  const target = (price * (signal==='SELL' ? (1-tpPct/100) : (1+tpPct/100))).toFixed(2);
  const sl = (price * (signal==='SELL' ? (1+slPct/100) : (1-slPct/100))).toFixed(2);
  const ret = signal==='SELL' ? `-${tpPct.toFixed(1)}%` : `+${tpPct.toFixed(1)}%`;
  const macdSig = signal==='BUY' ? 'Bullish Cross' : signal==='SELL' ? 'Bearish Cross' : 'Neutral';
  const trend = signal==='BUY' ? 'Uptrend' : signal==='SELL' ? 'Downtrend' : 'Sideways';
  const vol = ['Above Avg','Below Avg','High Surge'][Math.floor(Math.random()*3)];
  const support = (price*0.97).toFixed(0);
  const resist = (price*1.03).toFixed(0);
  const risk = conf>80 ? 'Low' : conf>65 ? 'Medium' : 'High';
  const ema50 = signal==='BUY' ? 'Above 50 EMA ‚úÖ' : 'Below 50 EMA ‚ö†Ô∏è';
  const ema200 = Math.random()>0.5 ? 'Above 200 EMA ‚úÖ' : 'Below 200 EMA ‚ö†Ô∏è';
  return { sym, price, signal, conf, target, sl, ret, rsi, macdSig, trend, vol, support, resist, risk, ema50, ema200 };
}

function showAnalysisResult(sym) {
  const a = generateAnalysis(sym);
  const card = document.getElementById('resultCard');
  const noRes = document.getElementById('noResult');
  card.style.display = 'block'; card.classList.add('show');
  noRes.style.display = 'none';

  const badge = document.getElementById('recBadge');
  badge.className = `rec-badge ${a.signal.toLowerCase()}`;
  badge.textContent = a.signal==='BUY'?'üìà BUY':a.signal==='SELL'?'üìâ SELL':'‚è∏Ô∏è HOLD';

  const fill = document.getElementById('confFill');
  const val = document.getElementById('confVal');
  fill.style.width='0%';
  setTimeout(()=>{ fill.style.width=a.conf+'%'; val.textContent=a.conf+'%'; }, 100);

  document.getElementById('targetPrice').textContent = '‚Çπ'+Number(a.target).toLocaleString('en-IN');
  document.getElementById('slPrice').textContent = '‚Çπ'+Number(a.sl).toLocaleString('en-IN');
  document.getElementById('retVal').textContent = a.ret;
  document.getElementById('retVal').className = 'target-val '+(a.signal==='SELL'?'dn':'up');

  const inds = [
    {name:'RSI',val:a.rsi,sig:a.rsi<35?'üü¢ Oversold':a.rsi>68?'üî¥ Overbought':'üü° Neutral',col:a.rsi<35?'var(--green)':a.rsi>68?'var(--red)':'var(--gold)'},
    {name:'MACD',val:'Signal',sig:a.macdSig,col:a.macdSig.includes('Bull')?'var(--green)':'var(--red)'},
    {name:'50 EMA',val:'',sig:a.ema50,col:a.ema50.includes('‚úÖ')?'var(--green)':'var(--gold)'},
    {name:'200 EMA',val:'',sig:a.ema200,col:a.ema200.includes('‚úÖ')?'var(--green)':'var(--gold)'},
    {name:'Volume',val:'',sig:a.vol,col:a.vol.includes('Surge')?'var(--accent)':'var(--text2)'},
    {name:'Trend',val:'',sig:a.trend,col:a.trend==='Uptrend'?'var(--green)':a.trend==='Downtrend'?'var(--red)':'var(--gold)'},
  ];
  const grid = document.getElementById('indGrid');
  grid.innerHTML = inds.map(i=>`
    <div class="ind-card">
      <div class="ind-name">${i.name}</div>
      <div class="ind-val" style="color:${i.col}">${i.val||''}</div>
      <div class="ind-sig" style="color:${i.col}">${i.sig}</div>
    </div>`).join('');

  window._lastAnalysis = a;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHAT ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BOT_RESPONSES = {
  buy: (sym,a) => `<span class="inline-badge buy">üìà BUY</span> signal detected for <strong>${sym}</strong>

<table class="msg-table">
  <tr><td>Current Price</td><td>‚Çπ${a.price.toLocaleString('en-IN')}</td></tr>
  <tr><td>Target Price</td><td class="up">‚Çπ${Number(a.target).toLocaleString('en-IN')} (${a.ret})</td></tr>
  <tr><td>Stop Loss</td><td class="dn">‚Çπ${Number(a.sl).toLocaleString('en-IN')}</td></tr>
  <tr><td>RSI</td><td>${a.rsi} ‚Äî Oversold zone</td></tr>
  <tr><td>MACD</td><td>${a.macdSig}</td></tr>
  <tr><td>Confidence</td><td>${a.conf}%</td></tr>
  <tr><td>Risk Level</td><td><span class="risk-badge risk-${a.risk.toLowerCase()}">${a.risk}</span></td></tr>
  <tr><td>Timeframe</td><td>${currentTf}</td></tr>
</table>

<em style="font-size:11px;color:var(--text2);display:block;margin-top:8px">‚ö†Ô∏è AI analysis only. Not SEBI registered advice. Please do your own research before trading.</em>`,

  sell: (sym,a) => `<span class="inline-badge sell">üìâ SELL</span> signal for <strong>${sym}</strong>

RSI at ${a.rsi} ‚Äî overbought territory. Bearish momentum detected on MACD (${a.macdSig}). Volume declining on up-moves signals distribution.

<table class="msg-table">
  <tr><td>Exit at</td><td>‚Çπ${a.price.toLocaleString('en-IN')}</td></tr>
  <tr><td>Stop Loss</td><td class="dn">‚Çπ${Number(a.sl).toLocaleString('en-IN')}</td></tr>
  <tr><td>Expected Move</td><td class="dn">${a.ret}</td></tr>
  <tr><td>Resistance</td><td>‚Çπ${a.resist}</td></tr>
  <tr><td>Confidence</td><td>${a.conf}%</td></tr>
</table>
<em style="font-size:11px;color:var(--text2);display:block;margin-top:8px">‚ö†Ô∏è Not investment advice. Trade at your own risk.</em>`,

  hold: (sym,a) => `<span class="inline-badge hold">‚è∏Ô∏è HOLD</span> ‚Äî No clear signal for <strong>${sym}</strong>

Market is in a consolidation phase. RSI at ${a.rsi} ‚Äî neutral zone. Wait for a breakout above ‚Çπ${a.resist} or breakdown below ‚Çπ${a.support} before entering.

<table class="msg-table">
  <tr><td>Support</td><td>‚Çπ${a.support}</td></tr>
  <tr><td>Resistance</td><td>‚Çπ${a.resist}</td></tr>
  <tr><td>Trend</td><td>${a.trend}</td></tr>
  <tr><td>Volume</td><td>${a.vol}</td></tr>
</table>
<em style="font-size:11px;color:var(--text2);display:block;margin-top:8px">Watch for volume expansion and price breakout confirmation.</em>`,

  options: (sym,a) => `üéØ <strong>Options Strategy for ${sym}:</strong>

Given the current trend (${a.trend}) and RSI at ${a.rsi}, here's a suitable strategy:

${a.signal==='BUY' ? `<strong>Strategy: Bull Call Spread</strong>
‚Ä¢ Buy ${Math.round(a.price/100)*100} CE
‚Ä¢ Sell ${Math.round(a.price/100)*100 + 200} CE
‚Ä¢ Max Profit: ‚Çπ~5,000 per lot
‚Ä¢ Max Loss: Premium paid
‚Ä¢ Breakeven: Strike + Premium` :
a.signal==='SELL' ? `<strong>Strategy: Bear Put Spread</strong>
‚Ä¢ Buy ${Math.round(a.price/100)*100} PE
‚Ä¢ Sell ${Math.round(a.price/100)*100 - 200} PE
‚Ä¢ Max Profit: ‚Çπ~4,500 per lot
‚Ä¢ Ideal if ${sym} falls 2‚Äì4%` :
`<strong>Strategy: Iron Condor</strong>
‚Ä¢ Sell ${Math.round(a.price/100)*100 + 200} CE + Buy ${Math.round(a.price/100)*100 + 400} CE
‚Ä¢ Sell ${Math.round(a.price/100)*100 - 200} PE + Buy ${Math.round(a.price/100)*100 - 400} PE
‚Ä¢ Max Profit: Premium collected
‚Ä¢ Best in sideways market (IV high)`}

<em style="font-size:11px;color:var(--text2);display:block;margin-top:8px">‚ö†Ô∏è F&O trading involves unlimited risk. Use strict position sizing.</em>`,

  rsi: () => `üìä <strong>What is RSI (Relative Strength Index)?</strong>

RSI is a momentum indicator that measures the speed and magnitude of price changes on a scale of 0‚Äì100.

<table class="msg-table">
  <tr><td>RSI above 70</td><td class="dn">Overbought ‚Äî possible reversal</td></tr>
  <tr><td>RSI below 30</td><td class="up">Oversold ‚Äî possible bounce</td></tr>
  <tr><td>RSI 40‚Äì60</td><td>Neutral / consolidation</td></tr>
  <tr><td>Period used</td><td>14 candles (standard)</td></tr>
</table>

üí° Best used with volume confirmation and support/resistance levels. Never use RSI alone for trading decisions.`,

  macd: () => `üìà <strong>MACD (Moving Average Convergence Divergence)</strong>

MACD shows the relationship between two EMAs (12 & 26 period). The Signal line is a 9-period EMA of MACD.

<table class="msg-table">
  <tr><td>Bullish Cross</td><td class="up">MACD crosses above Signal ‚Äî BUY signal</td></tr>
  <tr><td>Bearish Cross</td><td class="dn">MACD crosses below Signal ‚Äî SELL signal</td></tr>
  <tr><td>Histogram</td><td>Shows momentum strength</td></tr>
  <tr><td>Divergence</td><td>Price vs MACD diverging = reversal warning</td></tr>
</table>`,

  market: () => `üåê <strong>Market Overview ‚Äî Today</strong>

<table class="msg-table">
  <tr><td>NIFTY 50</td><td class="up">‚Çπ22,147 ‚ñ≤ +0.83%</td></tr>
  <tr><td>SENSEX</td><td class="up">‚Çπ73,088 ‚ñ≤ +0.79%</td></tr>
  <tr><td>BANKNIFTY</td><td class="up">‚Çπ47,892 ‚ñ≤ +1.12%</td></tr>
  <tr><td>India VIX</td><td class="dn">14.22 ‚ñº -2.80%</td></tr>
  <tr><td>Market</td><td class="up">Bullish ‚Äî Broad Rally</td></tr>
</table>

Top sectors gaining: IT (+1.88%), Auto (+2.44%), Realty (+3.21%)
Sectors losing: FMCG (-0.91%), Media (-1.44%)

üí° Low VIX + broad rally = favorable conditions for directional trades.`,

  topstocks: () => `üöÄ <strong>Top Stocks to Watch Today:</strong>

<table class="msg-table">
  <tr><td>TATAMOTORS</td><td class="up">+4.31% ‚Äî Strong breakout above resistance</td></tr>
  <tr><td>SBIN</td><td class="up">+2.11% ‚Äî PSU Bank rally, good momentum</td></tr>
  <tr><td>HCLTECH</td><td class="up">+1.88% ‚Äî IT sector buying, above 50 EMA</td></tr>
</table>

‚ö†Ô∏è These are technical observations, not buy recommendations. Always check your risk tolerance before trading.`,

  stoploss: () => `üõ°Ô∏è <strong>Stop Loss ‚Äî Your Most Important Tool</strong>

A stop loss is a pre-decided price at which you exit a losing trade to limit losses.

<table class="msg-table">
  <tr><td>Intraday trades</td><td>Use 0.5‚Äì1% stop loss</td></tr>
  <tr><td>Swing trades</td><td>Use 2‚Äì4% below entry</td></tr>
  <tr><td>Positional</td><td>Use key support levels</td></tr>
  <tr><td>Options</td><td>Exit if premium drops 40‚Äì50%</td></tr>
</table>

üí° Golden rule: Never trade without a stop loss. Risk only 1‚Äì2% of capital per trade.`,

  ironCondor: () => `üéØ <strong>Iron Condor Strategy ‚Äî Explained</strong>

An Iron Condor profits when the underlying stays within a range. Best used in high IV environments.

<strong>4 legs:</strong>
‚Ä¢ Buy OTM Call (higher strike)
‚Ä¢ Sell OTM Call (lower strike)
‚Ä¢ Sell OTM Put (higher strike)
‚Ä¢ Buy OTM Put (lower strike)

<table class="msg-table">
  <tr><td>Max Profit</td><td class="up">Net premium collected</td></tr>
  <tr><td>Max Loss</td><td class="dn">Difference between strikes ‚àí premium</td></tr>
  <tr><td>Best when</td><td>Market stays sideways</td></tr>
  <tr><td>Exit rule</td><td>Exit if underlying breaches either sold strike</td></tr>
</table>

üí° Perfect for BANKNIFTY/NIFTY during low-volatility weeks (VIX below 15).`,

  greeting: () => `üëã Hey there! I'm <strong>MarketEdge AI</strong>, your personal trading assistant.

Here's what I can help you with:
‚Ä¢ üìà <strong>Stock Analysis</strong> ‚Äî BUY/SELL/HOLD calls with targets & SL
‚Ä¢ üéØ <strong>Options Strategies</strong> ‚Äî Iron Condor, Straddle, Spreads
‚Ä¢ üìä <strong>Indicator Explanations</strong> ‚Äî RSI, MACD, EMA, VWAP
‚Ä¢ üåê <strong>Market Overview</strong> ‚Äî Sector performance, top movers
‚Ä¢ üõ°Ô∏è <strong>Risk Management</strong> ‚Äî Position sizing, stop loss guidance

Try asking: <em>"Analyze RELIANCE"</em> or <em>"Should I buy BANKNIFTY?"</em>

NSE market hours: <strong style="color:var(--accent)">9:15 AM ‚Äì 3:30 PM IST</strong>`,

  default: () => `ü§î I'm not sure I understood that completely. Here are some things you can ask me:

‚Ä¢ "Analyze [stock name]" ‚Äî Get BUY/SELL/HOLD recommendation
‚Ä¢ "What is RSI / MACD / EMA?"
‚Ä¢ "Best stocks to buy today"
‚Ä¢ "Explain Iron Condor / Straddle"
‚Ä¢ "What is stop loss?"
‚Ä¢ "Market overview today"

Type a stock name directly to get instant analysis!`
};

function getResponse(msg) {
  const m = msg.toLowerCase();
  // Detect stock symbols
  const symMatch = Object.keys(stockData).find(s => m.includes(s.toLowerCase()));

  if(m.match(/^(hi|hello|hey|good|namaste)/)) return BOT_RESPONSES.greeting();
  if(m.includes('market') && (m.includes('today')||m.includes('overview')||m.includes('trend'))) return BOT_RESPONSES.market();
  if(m.includes('top stock')||m.includes('best stock')||m.includes('buy today')) return BOT_RESPONSES.topstocks();
  if(m.includes('rsi')) return BOT_RESPONSES.rsi();
  if(m.includes('macd')) return BOT_RESPONSES.macd();
  if(m.includes('stop loss')||m.includes('stoploss')) return BOT_RESPONSES.stoploss();
  if(m.includes('iron condor')) return BOT_RESPONSES.ironCondor();
  if(m.includes('option')||m.includes('f&o')||m.includes('call')||m.includes('put')||m.includes('straddle')||m.includes('strangle')) {
    const s = symMatch || currentSym;
    const a = generateAnalysis(s);
    return BOT_RESPONSES.options(s, a);
  }
  if(symMatch || m.includes('analyze')||m.includes('buy')||m.includes('sell')||m.includes('hold')||m.includes('should i')) {
    const s = symMatch || currentSym;
    const a = generateAnalysis(s);
    currentSym = s;
    if(a.signal==='BUY') return BOT_RESPONSES.buy(s, a);
    if(a.signal==='SELL') return BOT_RESPONSES.sell(s, a);
    return BOT_RESPONSES.hold(s, a);
  }
  return BOT_RESPONSES.default();
}

function sendBotAnalysis(sym) {
  const a = generateAnalysis(sym);
  let resp;
  if(a.signal==='BUY') resp = BOT_RESPONSES.buy(sym, a);
  else if(a.signal==='SELL') resp = BOT_RESPONSES.sell(sym, a);
  else resp = BOT_RESPONSES.hold(sym, a);
  addBotMsg(`üìä <strong>AI Analysis for ${sym} (${currentTf})</strong><br><br>${resp}`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHAT UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getTime() {
  return new Date().toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit',hour12:true});
}

function addUserMsg(text) {
  const cw = document.getElementById('chatWindow');
  const div = document.createElement('div'); div.className='msg user';
  div.innerHTML=`<div class="msg-wrap"><div class="msg-bubble">${text}</div><div class="msg-time">${getTime()}</div></div><div class="msg-avatar user">üë§</div>`;
  cw.appendChild(div);
  cw.scrollTop=cw.scrollHeight;
}

function addBotMsg(html, delay=0) {
  const cw = document.getElementById('chatWindow');
  // Show typing
  const typing = document.createElement('div'); typing.className='typing'; typing.id='typingIndicator';
  typing.innerHTML=`<div class="msg-avatar bot" style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0">ü§ñ</div><div class="typing-dots"><span></span><span></span><span></span></div>`;
  cw.appendChild(typing);
  cw.scrollTop=cw.scrollHeight;
  const wait = delay || Math.random()*800+800;
  setTimeout(()=>{
    const t=document.getElementById('typingIndicator'); if(t) t.remove();
    const div=document.createElement('div'); div.className='msg bot';
    div.innerHTML=`<div class="msg-avatar bot" style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0">ü§ñ</div><div class="msg-wrap"><div class="msg-bubble">${html}</div><div class="msg-time">${getTime()}</div></div>`;
    cw.appendChild(div);
    cw.scrollTop=cw.scrollHeight;
  }, wait);
}

function sendMessage() {
  const inp = document.getElementById('chatInput');
  const msg = inp.value.trim();
  if(!msg) return;
  addUserMsg(msg);
  inp.value='';
  inp.style.height='auto';
  const resp = getResponse(msg);
  addBotMsg(resp);
}

function sendSuggestion(el) {
  const msg = el.textContent;
  document.getElementById('chatInput').value = msg;
  sendMessage();
}

function clearChat() {
  if(confirm('Clear all chat messages?')) {
    const cw = document.getElementById('chatWindow');
    cw.innerHTML='';
    addWelcomeMsg();
  }
}

function addWelcomeMsg() {
  setTimeout(()=>{ addBotMsg(BOT_RESPONSES.greeting(), 500); }, 300);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VOICE MODE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setMode(mode) {
  document.getElementById('chatModeBtn').classList.toggle('active', mode==='chat');
  document.getElementById('voiceModeBtn').classList.toggle('active', mode==='voice');
  document.getElementById('chatMode').style.display = mode==='chat' ? 'flex' : 'none';
  document.getElementById('voiceMode').classList.toggle('active', mode==='voice');
  if(mode==='voice') buildWaveform();
}

function buildWaveform() {
  const g = document.getElementById('waveformBars'); g.innerHTML='';
  for(let i=0;i<40;i++){
    const x=i*10+5;
    const h=Math.random()*30+10;
    const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('x',x); rect.setAttribute('y',(80-h)/2);
    rect.setAttribute('width',4); rect.setAttribute('height',h);
    rect.setAttribute('rx',2); rect.setAttribute('fill','var(--border)');
    rect.setAttribute('class','wave-bar');
    g.appendChild(rect);
  }
}

let waveInterval=null;
function animateWaveform(active) {
  const bars=document.querySelectorAll('.wave-bar');
  if(active){
    waveInterval=setInterval(()=>{
      bars.forEach(b=>{
        const h=Math.random()*50+10;
        b.setAttribute('y',(80-h)/2); b.setAttribute('height',h);
        b.setAttribute('fill','var(--accent)');
      });
    },100);
  } else {
    clearInterval(waveInterval);
    bars.forEach(b=>{ b.setAttribute('height',10); b.setAttribute('y',35); b.setAttribute('fill','var(--border)'); });
  }
}

function startVoice() {
  const btn = document.getElementById('voiceMicBtn');
  btn.classList.add('listening');
  document.getElementById('voiceStatus').textContent='Listening... Speak now';
  document.getElementById('voiceTranscript').textContent='...';
  animateWaveform(true);

  if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.lang='en-IN'; recognition.continuous=false; recognition.interimResults=true;
    recognition.onresult = (e)=>{
      const transcript = Array.from(e.results).map(r=>r[0].transcript).join('');
      document.getElementById('voiceTranscript').textContent=transcript;
    };
    recognition.onerror = ()=>{ stopVoice(); };
    recognition.start();
  } else {
    // Simulate if no API
    const demos=['Analyze RELIANCE','Should I buy NIFTY?','What is the market trend?','Explain Iron Condor for BANKNIFTY'];
    document.getElementById('voiceTranscript').textContent = demos[Math.floor(Math.random()*demos.length)];
  }
}

function stopVoice() {
  const btn=document.getElementById('voiceMicBtn');
  btn.classList.remove('listening');
  animateWaveform(false);
  if(recognition){recognition.stop(); recognition=null;}
  const transcript=document.getElementById('voiceTranscript').textContent;
  if(transcript && transcript!=='...' && transcript!=='Say a stock name or ask a question...'){
    document.getElementById('voiceStatus').textContent='Processing...';
    setTimeout(()=>{
      const resp=getResponse(transcript);
      const plain=resp.replace(/<[^>]*>/g,'').substring(0,200)+'...';
      const vr=document.getElementById('voiceResponse');
      vr.style.display='block'; vr.innerHTML=resp;
      document.getElementById('voiceStatus').textContent='Hold to speak ¬∑ Release to analyze';
      if(synth){ const utt=new SpeechSynthesisUtterance(plain); utt.lang='en-IN'; utt.rate=0.9; synth.speak(utt); }
    },1000);
  }
}

// Inline mic in chat
function toggleMicInline() {
  const btn=document.getElementById('micBtn');
  if(!isListening){
    isListening=true; btn.classList.add('listening');
    if('webkitSpeechRecognition' in window||'SpeechRecognition' in window){
      const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
      recognition=new SR(); recognition.lang='en-IN';
      recognition.onresult=(e)=>{
        const t=Array.from(e.results).map(r=>r[0].transcript).join('');
        document.getElementById('chatInput').value=t;
      };
      recognition.onend=()=>{ isListening=false; btn.classList.remove('listening'); recognition=null; };
      recognition.start();
    } else {
      setTimeout(()=>{ isListening=false; btn.classList.remove('listening'); },2000);
    }
  } else {
    isListening=false; btn.classList.remove('listening');
    if(recognition){recognition.stop();recognition=null;}
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTION BUTTONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openChart(){ alert(`Opening chart for ${currentSym} in Charts page...`); }
function placeOrder(){ alert(`Opening order panel for ${currentSym}...`); }
function addWatch(){ alert(`${currentSym} added to watchlist!`); }
function shareAnalysis(){
  const a=window._lastAnalysis;
  if(!a){alert('Run analysis first!');return;}
  const txt=`MarketEdge AI Analysis\nSymbol: ${a.sym}\nSignal: ${a.signal}\nPrice: ‚Çπ${a.price}\nTarget: ‚Çπ${a.target}\nSL: ‚Çπ${a.sl}\nConfidence: ${a.conf}%\n‚ö†Ô∏è Not SEBI registered advice.`;
  navigator.clipboard.writeText(txt).then(()=>alert('Analysis copied to clipboard!'));
}
function downloadAnalysis(){
  const a=window._lastAnalysis;
  const txt=a?`MarketEdge AI Analysis Report\n${'='.repeat(40)}\nSymbol: ${a.sym} | Signal: ${a.signal}\nPrice: ‚Çπ${a.price} | Target: ‚Çπ${a.target} | SL: ‚Çπ${a.sl}\nConfidence: ${a.conf}% | Risk: ${a.risk}\nRSI: ${a.rsi} | MACD: ${a.macdSig}\nTrend: ${a.trend} | Timeframe: ${currentTf}\n\n‚ö†Ô∏è Educational purposes only. Not SEBI registered advice.`:'MarketEdge AI Chat Export\nRun an analysis first.';
  const blob=new Blob([txt],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const link=document.createElement('a'); link.href=url; link.download=`MarketEdge_Analysis_${currentSym}.txt`; link.click();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INPUT HANDLERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const chatInput=document.getElementById('chatInput');
chatInput.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}
});
chatInput.addEventListener('input',function(){
  this.style.height='auto';
  this.style.height=Math.min(this.scrollHeight,100)+'px';
});
document.getElementById('symInput').addEventListener('keydown',e=>{
  if(e.key==='Enter') runAnalysis();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
addWelcomeMsg();

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   PRODUCTION API INTEGRATION ‚Äî Replace simulated responses
   with real Claude API calls via your backend:

   async function getRealAIResponse(userMessage) {
     const res = await fetch('/api/ai/analyze', {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({
         message: userMessage,
         symbol: currentSym,
         timeframe: currentTf
       })
     });
     const data = await res.json();
     return data.reply;
   }

   Backend route (Node.js/Express):
   app.post('/api/ai/analyze', async (req, res) => {
     const { message, symbol, timeframe } = req.body;
     const response = await fetch("https://api.anthropic.com/v1/messages", {
       method: "POST",
       headers: {
         "Content-Type": "application/json",
         "x-api-key": process.env.ANTHROPIC_API_KEY,
         "anthropic-version": "2023-06-01"
       },
       body: JSON.stringify({
         model: "claude-sonnet-4-20250514",
         max_tokens: 1000,
         system: `You are MarketEdge AI, an expert Indian stock market analyst.
                  Analyzing ${symbol} for ${timeframe} trading on NSE/BSE.
                  Give BUY/SELL/HOLD calls with targets, stop loss, RSI, MACD.
                  Use ‚Çπ symbol. Reference Indian market hours 9:15AM-3:30PM IST.
                  Always include a risk disclaimer.`,
         messages: [{ role: "user", content: message }]
       })
     });
     const data = await response.json();
     res.json({ reply: data.content[0].text });
   });
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
</script>
</body>
</html>
